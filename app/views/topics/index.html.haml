-# @static_render needs to disable cache for rendering in that context
- cache(['topics/index', @topics_cache_key]) do
  - set_title "#{Tenant.default_title}: All topics"

  .row
    .col
      %h2= (Tenant.current && Tenant.current.settings(:topic).heading) || "Topics"

  .row
    .col
      .card-columns.topic-card
        - @topics.each do |topic|
          .card.bg-light
            .icon_drop_target.topic_icon{id: "topic_icon_#{topic.id}", url: set_icon_topic_path(topic)}= link_to image_tag(topic.icon.url(:thumb), class: "card-img-top"), topic_path(topic)
          .card-body
            .card-title
              = link_to topic.name, topic_path(topic)
              = link_to "#{f_icon('x-circle', :color=>'#C66')}".html_safe, topic, :class=>"delete_topic", method: :delete, data: { confirm: 'Are you sure?' } if (current_user && current_user.admin?) && !@static_render
    
            .card-text
              - if topic.description.present?
                = truncate topic.description, length: 80*5
              - else
                - if !@static_render
                  = link_to edit_topic_path(topic) do
                    No description
            - if topic.sub_topics.present?
              .subtopics
                = "#{pluralize topic.descendants.count, 'subtopic'}"
  
- unless @static_render
  .row
    .col-lg-8
      = will_paginate(@topics) if @topic.respond_to?(:total_pages)
    .col
      = link_to 'Create new Topic', new_topic_path, :class=>'btn btn-primary'

